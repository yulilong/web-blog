<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS中的垃圾回收和内存泄露 | 前端知识</title>
    <meta name="description" content="一个总结前端知识的文档网站">
    <link rel="icon" href="/logo.png">
  <script defer="defer" src="/static/jquery.slim.min.js"></script>
  <script defer="defer" src="/static/jquery.fancybox.min.js"></script>
  <link defer="defer" rel="stylesheet" type="text/css" href="/static/jquery.fancybox.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.f853b4b7.css" as="style"><link rel="preload" href="/assets/js/app.d18e3cd8.js" as="script"><link rel="preload" href="/assets/js/25.46b7f0f7.js" as="script"><link rel="prefetch" href="/assets/js/10.3c978b5a.js"><link rel="prefetch" href="/assets/js/100.9b8f41c4.js"><link rel="prefetch" href="/assets/js/101.dcb14acc.js"><link rel="prefetch" href="/assets/js/102.2a82642e.js"><link rel="prefetch" href="/assets/js/103.55c75880.js"><link rel="prefetch" href="/assets/js/104.a5152a18.js"><link rel="prefetch" href="/assets/js/105.9375539d.js"><link rel="prefetch" href="/assets/js/106.d9f1826b.js"><link rel="prefetch" href="/assets/js/107.d5c5c1f8.js"><link rel="prefetch" href="/assets/js/108.d8593f40.js"><link rel="prefetch" href="/assets/js/109.30a5fddb.js"><link rel="prefetch" href="/assets/js/11.6ab74784.js"><link rel="prefetch" href="/assets/js/110.03c611c8.js"><link rel="prefetch" href="/assets/js/111.fc7ca03e.js"><link rel="prefetch" href="/assets/js/112.367cdd66.js"><link rel="prefetch" href="/assets/js/113.cf7bb4e5.js"><link rel="prefetch" href="/assets/js/114.f57ec866.js"><link rel="prefetch" href="/assets/js/115.fe4cb724.js"><link rel="prefetch" href="/assets/js/116.36ab89d2.js"><link rel="prefetch" href="/assets/js/117.339e33c1.js"><link rel="prefetch" href="/assets/js/118.ea4fdf1f.js"><link rel="prefetch" href="/assets/js/119.2f5e7ad5.js"><link rel="prefetch" href="/assets/js/12.4cec9bb8.js"><link rel="prefetch" href="/assets/js/120.d0b6a627.js"><link rel="prefetch" href="/assets/js/121.4db5f204.js"><link rel="prefetch" href="/assets/js/122.7e8b2e37.js"><link rel="prefetch" href="/assets/js/123.8207072c.js"><link rel="prefetch" href="/assets/js/124.fb8492d2.js"><link rel="prefetch" href="/assets/js/125.14a7b753.js"><link rel="prefetch" href="/assets/js/126.083ab1b8.js"><link rel="prefetch" href="/assets/js/127.ab9e679e.js"><link rel="prefetch" href="/assets/js/128.cc5820bf.js"><link rel="prefetch" href="/assets/js/129.02bea52d.js"><link rel="prefetch" href="/assets/js/13.e972d6f5.js"><link rel="prefetch" href="/assets/js/130.f8ffe2f4.js"><link rel="prefetch" href="/assets/js/131.3c0af687.js"><link rel="prefetch" href="/assets/js/132.aa179cb6.js"><link rel="prefetch" href="/assets/js/133.cc1c8185.js"><link rel="prefetch" href="/assets/js/134.ecc94f2e.js"><link rel="prefetch" href="/assets/js/135.1675c120.js"><link rel="prefetch" href="/assets/js/136.9bb8c110.js"><link rel="prefetch" href="/assets/js/137.9a695475.js"><link rel="prefetch" href="/assets/js/138.5c1831e3.js"><link rel="prefetch" href="/assets/js/139.0a1a42fc.js"><link rel="prefetch" href="/assets/js/14.9ecf3cc3.js"><link rel="prefetch" href="/assets/js/140.3be7077d.js"><link rel="prefetch" href="/assets/js/141.28f54311.js"><link rel="prefetch" href="/assets/js/142.0f732a49.js"><link rel="prefetch" href="/assets/js/143.f881196c.js"><link rel="prefetch" href="/assets/js/144.316091b1.js"><link rel="prefetch" href="/assets/js/145.cadf2477.js"><link rel="prefetch" href="/assets/js/146.5466844b.js"><link rel="prefetch" href="/assets/js/147.7cc8ecd4.js"><link rel="prefetch" href="/assets/js/148.0c7096b4.js"><link rel="prefetch" href="/assets/js/149.b7d0671e.js"><link rel="prefetch" href="/assets/js/15.3282e7bc.js"><link rel="prefetch" href="/assets/js/150.a47e1f20.js"><link rel="prefetch" href="/assets/js/151.36e1b50a.js"><link rel="prefetch" href="/assets/js/152.5d96ea9a.js"><link rel="prefetch" href="/assets/js/153.cc3adca1.js"><link rel="prefetch" href="/assets/js/154.687485c7.js"><link rel="prefetch" href="/assets/js/155.2ea2cbe9.js"><link rel="prefetch" href="/assets/js/156.63062ccb.js"><link rel="prefetch" href="/assets/js/157.755c1908.js"><link rel="prefetch" href="/assets/js/158.40a62d85.js"><link rel="prefetch" href="/assets/js/159.cdfe4c43.js"><link rel="prefetch" href="/assets/js/16.244bcfa5.js"><link rel="prefetch" href="/assets/js/160.68062187.js"><link rel="prefetch" href="/assets/js/161.777109f1.js"><link rel="prefetch" href="/assets/js/162.2b93ef1f.js"><link rel="prefetch" href="/assets/js/163.da08cb7d.js"><link rel="prefetch" href="/assets/js/164.db62a311.js"><link rel="prefetch" href="/assets/js/165.9612d1f6.js"><link rel="prefetch" href="/assets/js/166.5960d960.js"><link rel="prefetch" href="/assets/js/167.2f617057.js"><link rel="prefetch" href="/assets/js/168.771d586a.js"><link rel="prefetch" href="/assets/js/169.87844344.js"><link rel="prefetch" href="/assets/js/17.00bdfaf3.js"><link rel="prefetch" href="/assets/js/170.5ad0f0fe.js"><link rel="prefetch" href="/assets/js/171.22786ba3.js"><link rel="prefetch" href="/assets/js/172.49e5451f.js"><link rel="prefetch" href="/assets/js/173.7462313e.js"><link rel="prefetch" href="/assets/js/174.54b4d11a.js"><link rel="prefetch" href="/assets/js/175.864a2fa0.js"><link rel="prefetch" href="/assets/js/176.be990953.js"><link rel="prefetch" href="/assets/js/177.c8d7cc4b.js"><link rel="prefetch" href="/assets/js/178.ad23f326.js"><link rel="prefetch" href="/assets/js/179.a3371a0b.js"><link rel="prefetch" href="/assets/js/18.08f61532.js"><link rel="prefetch" href="/assets/js/180.5f048298.js"><link rel="prefetch" href="/assets/js/181.7067dd7e.js"><link rel="prefetch" href="/assets/js/182.bf312b74.js"><link rel="prefetch" href="/assets/js/183.a89af512.js"><link rel="prefetch" href="/assets/js/19.242fcc4c.js"><link rel="prefetch" href="/assets/js/20.d4eaf7fd.js"><link rel="prefetch" href="/assets/js/21.f10b82b9.js"><link rel="prefetch" href="/assets/js/22.396ecbe9.js"><link rel="prefetch" href="/assets/js/23.2a295290.js"><link rel="prefetch" href="/assets/js/24.e3566310.js"><link rel="prefetch" href="/assets/js/26.12012ffc.js"><link rel="prefetch" href="/assets/js/27.b93a3bc5.js"><link rel="prefetch" href="/assets/js/28.3ea2eb49.js"><link rel="prefetch" href="/assets/js/29.00cbeabe.js"><link rel="prefetch" href="/assets/js/3.b6ed6d58.js"><link rel="prefetch" href="/assets/js/30.a7935a4d.js"><link rel="prefetch" href="/assets/js/31.6d248f8a.js"><link rel="prefetch" href="/assets/js/32.f9afe09b.js"><link rel="prefetch" href="/assets/js/33.939c22ed.js"><link rel="prefetch" href="/assets/js/34.a464644d.js"><link rel="prefetch" href="/assets/js/35.e0524ba3.js"><link rel="prefetch" href="/assets/js/36.5688d8bd.js"><link rel="prefetch" href="/assets/js/37.7896942a.js"><link rel="prefetch" href="/assets/js/38.253f4230.js"><link rel="prefetch" href="/assets/js/39.9918fed7.js"><link rel="prefetch" href="/assets/js/4.8438802a.js"><link rel="prefetch" href="/assets/js/40.1d42dfef.js"><link rel="prefetch" href="/assets/js/41.76b0c57f.js"><link rel="prefetch" href="/assets/js/42.e52038b9.js"><link rel="prefetch" href="/assets/js/43.fc6145a7.js"><link rel="prefetch" href="/assets/js/44.ed10f39c.js"><link rel="prefetch" href="/assets/js/45.f9f0d3ba.js"><link rel="prefetch" href="/assets/js/46.f7837284.js"><link rel="prefetch" href="/assets/js/47.669d5c62.js"><link rel="prefetch" href="/assets/js/48.88990bb5.js"><link rel="prefetch" href="/assets/js/49.eedc9b6d.js"><link rel="prefetch" href="/assets/js/5.4b3327ea.js"><link rel="prefetch" href="/assets/js/50.38863926.js"><link rel="prefetch" href="/assets/js/51.5a4009b9.js"><link rel="prefetch" href="/assets/js/52.53824857.js"><link rel="prefetch" href="/assets/js/53.fed8ed8c.js"><link rel="prefetch" href="/assets/js/54.2828e1eb.js"><link rel="prefetch" href="/assets/js/55.15a29884.js"><link rel="prefetch" href="/assets/js/56.a1e8dd20.js"><link rel="prefetch" href="/assets/js/57.a193beae.js"><link rel="prefetch" href="/assets/js/58.a35586fc.js"><link rel="prefetch" href="/assets/js/59.298e7a30.js"><link rel="prefetch" href="/assets/js/6.8f8061d5.js"><link rel="prefetch" href="/assets/js/60.309949d3.js"><link rel="prefetch" href="/assets/js/61.5b2438a2.js"><link rel="prefetch" href="/assets/js/62.0b6fc5ab.js"><link rel="prefetch" href="/assets/js/63.9e907533.js"><link rel="prefetch" href="/assets/js/64.cf2f109e.js"><link rel="prefetch" href="/assets/js/65.2e76882c.js"><link rel="prefetch" href="/assets/js/66.1e168f9f.js"><link rel="prefetch" href="/assets/js/67.b8fa7712.js"><link rel="prefetch" href="/assets/js/68.40717004.js"><link rel="prefetch" href="/assets/js/69.54334dfe.js"><link rel="prefetch" href="/assets/js/7.d1c694a0.js"><link rel="prefetch" href="/assets/js/70.e98d0df3.js"><link rel="prefetch" href="/assets/js/71.e6e23663.js"><link rel="prefetch" href="/assets/js/72.72ec9dd5.js"><link rel="prefetch" href="/assets/js/73.c573567c.js"><link rel="prefetch" href="/assets/js/74.e6428ff0.js"><link rel="prefetch" href="/assets/js/75.49650c1b.js"><link rel="prefetch" href="/assets/js/76.810190c5.js"><link rel="prefetch" href="/assets/js/77.4316f3d1.js"><link rel="prefetch" href="/assets/js/78.41e6fcb1.js"><link rel="prefetch" href="/assets/js/79.d90102bc.js"><link rel="prefetch" href="/assets/js/8.c1134aff.js"><link rel="prefetch" href="/assets/js/80.67f442b0.js"><link rel="prefetch" href="/assets/js/81.58cd2086.js"><link rel="prefetch" href="/assets/js/82.0af25307.js"><link rel="prefetch" href="/assets/js/83.57cb0313.js"><link rel="prefetch" href="/assets/js/84.7c4c1b25.js"><link rel="prefetch" href="/assets/js/85.f07b510a.js"><link rel="prefetch" href="/assets/js/86.3252a34b.js"><link rel="prefetch" href="/assets/js/87.32c33b26.js"><link rel="prefetch" href="/assets/js/88.1a13f763.js"><link rel="prefetch" href="/assets/js/89.ce95ef88.js"><link rel="prefetch" href="/assets/js/9.cc043a67.js"><link rel="prefetch" href="/assets/js/90.4900a855.js"><link rel="prefetch" href="/assets/js/91.db19c502.js"><link rel="prefetch" href="/assets/js/92.cadb5507.js"><link rel="prefetch" href="/assets/js/93.59c3b44d.js"><link rel="prefetch" href="/assets/js/94.0c53fb42.js"><link rel="prefetch" href="/assets/js/95.69e14251.js"><link rel="prefetch" href="/assets/js/96.abcd14db.js"><link rel="prefetch" href="/assets/js/97.219ac966.js"><link rel="prefetch" href="/assets/js/98.c7176d4a.js"><link rel="prefetch" href="/assets/js/99.6bee146d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f48d90bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f853b4b7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="前端知识" class="logo"> <span class="site-name can-hide">前端知识</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="/doc/es6/" class="nav-link">ES6</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/js/" class="nav-link router-link-active">js</a></li><li class="dropdown-item"><!----> <a href="/doc/js/standardLibrary/" class="nav-link">js标准库</a></li><li class="dropdown-item"><!----> <a href="/doc/dom/" class="nav-link">dom操作文档</a></li><li class="dropdown-item"><!----> <a href="/doc/browserNetwork/" class="nav-link">浏览器、网络</a></li><li class="dropdown-item"><!----> <a href="/doc/designPattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/doc/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/doc/html/" class="nav-link">html</a></div><div class="nav-item"><a href="/doc/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/doc/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/doc/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/doc/tool/" class="nav-link">工具</a></div> <a href="https://github.com/yulilong/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/catalog.html" class="nav-link">目录</a></div><div class="nav-item"><a href="/doc/es6/" class="nav-link">ES6</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">javascript</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/js/" class="nav-link router-link-active">js</a></li><li class="dropdown-item"><!----> <a href="/doc/js/standardLibrary/" class="nav-link">js标准库</a></li><li class="dropdown-item"><!----> <a href="/doc/dom/" class="nav-link">dom操作文档</a></li><li class="dropdown-item"><!----> <a href="/doc/browserNetwork/" class="nav-link">浏览器、网络</a></li><li class="dropdown-item"><!----> <a href="/doc/designPattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><a href="/doc/css/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/doc/html/" class="nav-link">html</a></div><div class="nav-item"><a href="/doc/react/" class="nav-link">react</a></div><div class="nav-item"><a href="/doc/vue/" class="nav-link">vue</a></div><div class="nav-item"><a href="/doc/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/doc/tool/" class="nav-link">工具</a></div> <a href="https://github.com/yulilong/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/doc/js/" class="one-level sidebar-link">JavaScript部分说明</a></li><li><a href="/doc/js/001-对象原型继承.html" class="one-level sidebar-link">对象原型继承</a></li><li><a href="/doc/js/002-this_call_apply_bind.html" class="one-level sidebar-link">this、call、apply、bind</a></li><li><a href="/doc/js/003-数据类型转换.html" class="one-level sidebar-link">数据类型转换</a></li><li><a href="/doc/js/004-跨域.html" class="one-level sidebar-link">跨域</a></li><li><a href="/doc/js/005-Ajax.html" class="one-level sidebar-link">Ajax</a></li><li><a href="/doc/js/006-函数.html" class="one-level sidebar-link">函数</a></li><li><a href="/doc/js/007-作用域.html" class="one-level sidebar-link">作用域</a></li><li><a href="/doc/js/008-排序算法.html" class="one-level sidebar-link">排序算法</a></li><li><a href="/doc/js/009-获取标签宽高及实例.html" class="one-level sidebar-link">获取标签的宽高及例子</a></li><li><a href="/doc/js/010-从输入URL到页面渲染过程.html" class="one-level sidebar-link">从输入URL到页面渲染过程</a></li><li><a href="/doc/js/013-JS浮点数运算的精度问题.html" class="one-level sidebar-link">JavaScript浮点数运算的精度问题</a></li><li><a href="/doc/js/014-Web-Worker使用教程.html" class="one-level sidebar-link">Web Worker 使用教程</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS代码执行机制和事件循环</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>高级</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/doc/js/advanced/001-ES6模块import_export.html" class="one-level sidebar-link">ES6模块import_export</a></li><li><a href="/doc/js/advanced/002-错误处理try_catch.html" class="one-level sidebar-link">错误处理try_catch</a></li><li><a href="/doc/js/advanced/003-常用的代码片段.html" class="one-level sidebar-link">常用代码片段</a></li><li><a href="/doc/js/advanced/004-轮播代码实现.html" class="one-level sidebar-link">轮播代码实现</a></li><li><a href="/doc/js/advanced/005-浏览器兼容.html" class="one-level sidebar-link">浏览器兼容</a></li><li><a href="/doc/js/advanced/006-手机端页面开发.html" class="one-level sidebar-link">手机端页面开发</a></li><li><a href="/doc/js/advanced/007-SEO搜索引擎优化.html" class="one-level sidebar-link">SEO搜索引擎优化</a></li><li><a href="/doc/js/advanced/008-前端数据模拟Mock.html" class="one-level sidebar-link">前端数据模拟Mock</a></li><li><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html" class="one-level one-level-active active sidebar-link">JS中的垃圾回收和内存泄露</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_1-垃圾回收的必要性" class="sidebar-link">1. 垃圾回收的必要性</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_2-垃圾回收机制" class="sidebar-link">2. 垃圾回收机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_2-1-标记清除" class="sidebar-link">2.1 标记清除</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_2-2-引用计数" class="sidebar-link">2.2 引用计数</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_3-哪些情况会引起内存泄漏？" class="sidebar-link">3. 哪些情况会引起内存泄漏？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_3-1-意外的全局变量" class="sidebar-link">3.1 意外的全局变量</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_3-2-被遗忘的计时器或回调函数" class="sidebar-link">3.2 被遗忘的计时器或回调函数</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_3-3-闭包" class="sidebar-link">3.3 闭包</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_3-4-没有清理的dom元素引用" class="sidebar-link">3.4 没有清理的DOM元素引用</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_4-内存泄漏的识别方法" class="sidebar-link">4. 内存泄漏的识别方法</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_5-垃圾回收的使用场景优化" class="sidebar-link">5. 垃圾回收的使用场景优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_5-1-数组array优化" class="sidebar-link">5.1 数组array优化</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_5-2-对象尽量复用" class="sidebar-link">5.2 对象尽量复用</a></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_5-3-在循环中的函数表达式，能复用最好放到循环外面" class="sidebar-link">5.3 在循环中的函数表达式，能复用最好放到循环外面</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/js/advanced/009-JS中的垃圾回收和内存泄露.html#_6-参考资料" class="sidebar-link">6. 参考资料</a></li></ul></li><li><a href="/doc/js/advanced/010-moment时间插件使用说明.html" class="one-level sidebar-link">moment时间插件使用说明</a></li><li><a href="/doc/js/advanced/011-react项目搭建.html" class="one-level sidebar-link">react项目搭建</a></li><li><a href="/doc/js/advanced/012-vue项目搭建.html" class="one-level sidebar-link">vue项目搭建</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>文章</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>浏览器模型</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#_1-垃圾回收的必要性">1. 垃圾回收的必要性</a></li><li><a href="#_2-垃圾回收机制">2. 垃圾回收机制</a><ul><li><a href="#_2-1-标记清除">2.1 标记清除</a></li><li><a href="#_2-2-引用计数">2.2 引用计数</a></li></ul></li><li><a href="#_3-哪些情况会引起内存泄漏？">3. 哪些情况会引起内存泄漏？</a><ul><li><a href="#_3-1-意外的全局变量">3.1 意外的全局变量</a></li><li><a href="#_3-2-被遗忘的计时器或回调函数">3.2 被遗忘的计时器或回调函数</a></li><li><a href="#_3-3-闭包">3.3 闭包</a></li><li><a href="#_3-4-没有清理的dom元素引用">3.4 没有清理的DOM元素引用</a></li></ul></li><li><a href="#_4-内存泄漏的识别方法">4. 内存泄漏的识别方法</a></li><li><a href="#_5-垃圾回收的使用场景优化">5. 垃圾回收的使用场景优化</a><ul><li><a href="#_5-1-数组array优化">5.1 数组array优化</a></li><li><a href="#_5-2-对象尽量复用">5.2 对象尽量复用</a></li><li><a href="#_5-3-在循环中的函数表达式，能复用最好放到循环外面">5.3 在循环中的函数表达式，能复用最好放到循环外面</a></li></ul></li><li><a href="#_6-参考资料">6. 参考资料</a></li></ul></div><p></p> <p>[TOC]</p> <h1 id="js中的垃圾回收和内存泄露"><a href="#js中的垃圾回收和内存泄露" aria-hidden="true" class="header-anchor">#</a> JS中的垃圾回收和内存泄露</h1> <p>转载：https://segmentfault.com/a/1190000019035469</p> <p>程序的运行需要内存。只要程序提出要求，操作系统或者运行时就必须供给内存。所谓的内存泄漏简单来说是不再用到的内存，没有及时释放。为了更好避免内存泄漏，我们先介绍Javascript垃圾回收机制。</p> <p>在C与C++等语言中，开发人员可以直接控制内存的申请和回收。但是在Java、C#、JavaScript语言中，变量的内存空间的申请和释放都由程序自己处理，开发人员不需要关心。也就是说Javascript具有自动垃圾回收机制(Garbage Collecation)。</p> <h2 id="_1-垃圾回收的必要性"><a href="#_1-垃圾回收的必要性" aria-hidden="true" class="header-anchor">#</a> 1. 垃圾回收的必要性</h2> <p>下面这段话引自《JavaScript权威指南（第四版）》</p> <p>由于字符串、对象和数组没有固定大小，所有当他们的大小已知时，才能对他们进行动态的存储分配。JavaScript程序每次创建字符串、数组或对象时，解释器都必须分配内存来存储那个实体。只要像这样动态地分配了内存，最终都要释放这些内存以便他们能够被再用，否则，JavaScript的解释器将会消耗完系统中所有可用的内存，造成系统崩溃。</p> <p>这段话解释了为什么需要系统需要垃圾回收，JavaScript不像C/C++，它有自己的一套垃圾回收机制。</p> <p>JavaScript垃圾回收的机制很简单：找出不再使用的变量，然后释放掉其占用的内存，但是这个过程不是时时的，因为其开销比较大，所以垃圾回收器会按照固定的时间间隔周期性的执行。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;浪里行舟&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">&quot;前端工匠&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> b<span class="token punctuation">;</span> <span class="token comment">//重写a</span>
</code></pre></div><p>这段代码运行之后，“浪里行舟”这个字符串失去了引用（之前是被a引用），系统检测到这个事实之后，就会释放该字符串的存储空间以便这些空间可以被再利用。</p> <h2 id="_2-垃圾回收机制"><a href="#_2-垃圾回收机制" aria-hidden="true" class="header-anchor">#</a> 2. 垃圾回收机制</h2> <p>垃圾回收机制怎么知道，哪些内存不再需要呢？</p> <p>垃圾回收有两种方法：<strong>标记清除、引用计数</strong>。引用计数不太常用，标记清除较为常用。</p> <h3 id="_2-1-标记清除"><a href="#_2-1-标记清除" aria-hidden="true" class="header-anchor">#</a> 2.1 标记清除</h3> <p><strong>这是javascript中最常用的垃圾回收方式</strong>。当变量进入执行环境是，就标记这个变量为“进入环境”。从逻辑上讲，永远不能释放进入环境的变量所占用的内存，因为只要执行流进入相应的环境，就可能会用到他们。当变量离开环境时，则将其标记为“离开环境”。</p> <p>垃圾收集器在运行的时候会给存储在内存中的所有变量都加上标记。然后，它会去掉环境中的变量以及被环境中的变量引用的标记。而在此之后再被加上标记的变量将被视为准备删除的变量，原因是环境中的变量已经无法访问到这些变量了。最后。垃圾收集器完成内存清除工作，销毁那些带标记的值，并回收他们所占用的内存空间。</p> <p><img src="/assets/img/003-advanced.32061c3e.gif" alt></p> <p>我们用个例子，解释下这个方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>n <span class="token operator">=</span> <span class="token number">19</span> <span class="token comment">// 把 m,n,add() 标记为进入环境。</span>
<span class="token function">add</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token comment">// 把 a, b, c标记为进入环境。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// a,b,c标记为离开环境，等待垃圾回收。</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a<span class="token operator">++</span>
  <span class="token keyword">var</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b
  <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-引用计数"><a href="#_2-2-引用计数" aria-hidden="true" class="header-anchor">#</a> 2.2 引用计数</h3> <p>所谓&quot;引用计数&quot;是指语言引擎有一张&quot;引用表&quot;，保存了内存里面所有的资源（通常是各种值）的引用次数。如果一个值的引用次数是0，就表示这个值不再用到了，因此可以将这块内存释放。</p> <p><img src="data:image/png;base64,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" alt="img"></p> <p>上图中，左下角的两个值，没有任何引用，所以可以释放。</p> <p>如果一个值不再需要了，引用数却不为0，垃圾回收机制无法释放这块内存，从而导致内存泄漏。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'浪里行舟'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，数组[1, 2, 3, 4]是一个值，会占用内存。变量arr是仅有的对这个值的引用，因此引用次数为1。尽管后面的代码没有用到arr，它还是会持续占用内存。至于如何释放内存，我们下文介绍。</p> <p>第三行代码中，数组[1, 2, 3, 4]引用的变量arr又取得了另外一个值，则数组[1, 2, 3, 4]的引用次数就减1，此时它引用次数变成0，则说明没有办法再访问这个值了，因而就可以将其所占的内存空间给收回来。</p> <p>但是引用计数有个最大的问题： 循环引用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    obj1<span class="token punctuation">.</span>a <span class="token operator">=</span> obj2<span class="token punctuation">;</span> <span class="token comment">// obj1 引用 obj2</span>
    obj2<span class="token punctuation">.</span>a <span class="token operator">=</span> obj1<span class="token punctuation">;</span> <span class="token comment">// obj2 引用 obj1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当函数 func 执行结束后，返回值为 undefined，所以整个函数以及内部的变量都应该被回收，但根据引用计数方法，obj1 和 obj2 的引用次数都不为 0，所以他们不会被回收。</p> <p>要解决循环引用的问题，最好是在不使用它们的时候手工将它们设为空。上面的例子可以这么做：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>obj1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
obj2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_3-哪些情况会引起内存泄漏？"><a href="#_3-哪些情况会引起内存泄漏？" aria-hidden="true" class="header-anchor">#</a> 3. 哪些情况会引起内存泄漏？</h2> <p>虽然JavaScript会自动垃圾收集，但是如果我们的代码写法不当，会让变量一直处于“进入环境”的状态，无法被回收。下面列一下内存泄漏常见的几种情况：</p> <h3 id="_3-1-意外的全局变量"><a href="#_3-1-意外的全局变量" aria-hidden="true" class="header-anchor">#</a> 3.1 意外的全局变量</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bar <span class="token operator">=</span> <span class="token string">&quot;this is a hidden global variable&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>bar没被声明,会变成一个全局变量,在页面关闭之前不会被释放。</p> <p>另一种意外的全局变量可能由 <code>this</code> 创建:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>variable <span class="token operator">=</span> <span class="token string">&quot;potential accidental global&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// foo 调用自己，this 指向了全局对象（window）</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在 JavaScript 文件头部加上 'use strict'，可以避免此类错误发生。启用严格模式解析 JavaScript ，避免意外的全局变量。</p> <h3 id="_3-2-被遗忘的计时器或回调函数"><a href="#_3-2-被遗忘的计时器或回调函数" aria-hidden="true" class="header-anchor">#</a> 3.2 被遗忘的计时器或回调函数</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> someResource <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'Node'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理 node 和 someResource</span>
        node<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>someResource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样的代码很常见，如果id为Node的元素从DOM中移除，该定时器仍会存在，同时，因为回调函数中包含对someResource的引用，定时器外面的someResource也不会被释放。</p> <h3 id="_3-3-闭包"><a href="#_3-3-闭包" aria-hidden="true" class="header-anchor">#</a> 3.3 闭包</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
  obj<span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// Even if it is a empty function</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>闭包可以维持函数内局部变量，使其得不到释放。上例定义事件回调时，由于是函数内定义函数，并且内部函数--事件回调引用外部函数，形成了闭包。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 将事件处理函数定义在外面</span>
<span class="token keyword">function</span> <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
  obj<span class="token punctuation">.</span>onclick <span class="token operator">=</span> onclickHandler
<span class="token punctuation">}</span>
<span class="token comment">// 或者在定义事件处理函数的外部函数中，删除对dom的引用</span>
<span class="token keyword">function</span> <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
  obj<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Even if it is a empty function</span>
  <span class="token punctuation">}</span>
  obj <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><p>解决之道，将事件处理函数定义在外部，解除闭包，或者在定义事件处理函数的外部函数中，删除对dom的引用。</p> <h3 id="_3-4-没有清理的dom元素引用"><a href="#_3-4-没有清理的dom元素引用" aria-hidden="true" class="header-anchor">#</a> 3.4 没有清理的DOM元素引用</h3> <p>有时，保存 DOM 节点内部数据结构很有用。假如你想快速更新表格的几行内容，把每一行 DOM 存成字典（JSON 键值对）或者数组很有意义。此时，同样的 DOM 元素存在两个引用：一个在 DOM 树中，另一个在字典中。将来你决定删除这些行时，需要把两个引用都清除。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> elements <span class="token operator">=</span> <span class="token punctuation">{</span>
    button<span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    image<span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    text<span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://some.url/image'</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">removeButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时，仍旧存在一个全局的 #button 的引用</span>
    <span class="token comment">// elements 字典。button 元素仍旧在内存中，不能被 GC 回收。</span>
<span class="token punctuation">}</span>
</code></pre></div><p>虽然我们用removeChild移除了button，但是还在elements对象里保存着#button的引用，换言之，DOM元素还在内存里面。</p> <h2 id="_4-内存泄漏的识别方法"><a href="#_4-内存泄漏的识别方法" aria-hidden="true" class="header-anchor">#</a> 4. 内存泄漏的识别方法</h2> <p>新版本的chrome在 performance 中查看, 打开performance步骤：</p> <ul><li>页面右键 -&gt; Inspect，在弹出的开发者工具中，选择 Performance</li> <li>勾选 Screenshots 和 memory</li> <li>左上角小圆点开始录制(record)</li> <li>停止录制</li></ul> <p>图中 Heap 对应的部分就可以看到内存在周期性的回落也可以看到垃圾回收的周期,如果垃圾回收之后的最低值(我们称为min),min在不断上涨,那么肯定是有较为严重的内存泄漏问题。</p> <p><img src="/assets/img/005.a75ec42f.png" alt="img"></p> <p>避免内存泄漏的一些方式：</p> <ul><li>减少不必要的全局变量，或者生命周期较长的对象，及时对无用的数据进行垃圾回收</li> <li>注意程序逻辑，避免“死循环”之类的</li> <li>避免创建过多的对象</li></ul> <p>总而言之需要遵循一条<strong>原则：不用了的东西要及时归还</strong></p> <h2 id="_5-垃圾回收的使用场景优化"><a href="#_5-垃圾回收的使用场景优化" aria-hidden="true" class="header-anchor">#</a> 5. 垃圾回收的使用场景优化</h2> <h3 id="_5-1-数组array优化"><a href="#_5-1-数组array优化" aria-hidden="true" class="header-anchor">#</a> 5.1 数组array优化</h3> <p>将[]赋值给一个数组对象，是清空数组的捷径(例如： arr = []😉,但是需要注意的是，这种方式又创建了一个新的空对象，并且将原来的数组对象变成了一小片内存垃圾！实际上，将数组长度赋值为0（arr.length = 0）也能达到清空数组的目的，并且同时能实现数组重用，减少内存垃圾的产生。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'浪里行舟'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// 可以直接让数字清空，而且数组类型不变。</span>
<span class="token comment">// arr = []; 虽然让a变量成一个空数组,但是在堆上重新申请了一个空数组对象。</span>
</code></pre></div><h3 id="_5-2-对象尽量复用"><a href="#_5-2-对象尽量复用" aria-hidden="true" class="header-anchor">#</a> 5.2 对象尽量复用</h3> <p>对象尽量复用，尤其是在循环等地方出现创建新对象，能复用就复用。不用的对象，尽可能设置为null，尽快被垃圾回收掉。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 每次循环都会创建一个新对象。</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// var t = {};// 每次循环都会创建一个新对象。</span>
  t<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>
  t<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'123'</span>
  t<span class="token punctuation">.</span>index <span class="token operator">=</span> i
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
t <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">//对象如果已经不用了，那就立即设置为null；等待垃圾回收。</span>
</code></pre></div><h3 id="_5-3-在循环中的函数表达式，能复用最好放到循环外面"><a href="#_5-3-在循环中的函数表达式，能复用最好放到循环外面" aria-hidden="true" class="header-anchor">#</a> 5.3 在循环中的函数表达式，能复用最好放到循环外面</h3> <div class="language- extra-class"><pre class="language-text"><code>// 在循环中最好也别使用函数表达式。
for (var k = 0; k &lt; 10; k++) {
  var t = function(a) {
    // 创建了10次  函数对象。
    console.log(a)
  }
  t(k)
}
// 推荐用法
function t(a) {
  console.log(a)
}
for (var k = 0; k &lt; 10; k++) {
  t(k)
}
t = null
</code></pre></div><p><strong>给大家推荐一个好用的BUG监控工具<a href="https://www.fundebug.com/" target="_blank" rel="noopener noreferrer">Fundebug<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，欢迎免费试用！</strong></p> <h2 id="_6-参考资料"><a href="#_6-参考资料" aria-hidden="true" class="header-anchor">#</a> 6. 参考资料</h2> <ul><li><a href="https://github.com/ljianshu/Blog" target="_blank" rel="noopener noreferrer">作者的blog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://ke.qq.com/course/276435" target="_blank" rel="noopener noreferrer">JavaScript高级内幕（js高级）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/hustskyking/archive/2013/04/27/garbage-collection.html" target="_blank" rel="noopener noreferrer">JavaScript垃圾回收机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ruanyifeng.com/blog/2017/04/memory-leak.html" target="_blank" rel="noopener noreferrer">JavaScript 内存泄漏教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://book.douban.com/subject/1232061/" target="_blank" rel="noopener noreferrer">JavaScript权威指南（第四版）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/23992332" target="_blank" rel="noopener noreferrer">JavaScript 中的垃圾回收<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ruanyifeng.com/blog/2017/04/memory-leak.html" target="_blank" rel="noopener noreferrer">4类 JavaScript 内存泄漏及如何避免<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/yulilong/front-end-doc/edit/master/doc/js/advanced/009-JS中的垃圾回收和内存泄露.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/25/2019, 1:16:28 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/25.46b7f0f7.js" defer></script><script src="/assets/js/app.d18e3cd8.js" defer></script>
  </body>
</html>
